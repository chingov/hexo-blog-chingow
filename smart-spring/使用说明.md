## 使用说明

### 代码结构
当我们拿到一个使用了这套框架的初始化项目，亦或是一个成熟的项目，它的结构大概是这样的：
```
.fm-parent
|-- db-change ············································· 数据库表字段更改记录
|
|-- startup ··············································· 启动脚本，部分项目可能无
|
|-- fm-core ··············································· 项目公共jar包，一般存放功能变量及方法，小型项目可废弃。
|   |-- src 
|   |   |-- main
|   |   |   |-- java 
|   |   |   |   `-- 包路径             
|   |   |   |       |-- constants ························· 公共常量目录，各个子项目所需的内部常量，不包含api所需对外常量             
|   |   |   |       `-- utils ·····························         
|   |   |   `-- resources
|   |   `-- test
|   `-- pom.xml ···········································
|
|-- fm-api ················································ 项目dubbo-api包，提供对外接口能力，存放api接口和接口出入参数模型
|   |-- src 
|   |   |-- main
|   |   |   |-- java
|   |   |   |   `-- 包路径             
|   |   |   |       |-- constants ························· 常量目录，提供对外的常量；若无core子系统，则存放所有常量            
|   |   |   |       |-- api ······························· dubbo-api接口目录             
|   |   |   |       `-- model ····························· 接口出入参数模型目录，模型一般以Dto结尾            
|   |   |   |           |-- 模块1              
|   |   |   |           `-- 模块2              
|   |   |   `-- resources
|   |   |       `-- dubbo ································· duubo配置文件目录
|   |   |           `-- dubbo-consume-demo.xml ············ 提供给消费者的duubo接口，便于消费者集成
|   |   `-- test
|   `-- pom.xml ··········································· 构建配置信息
|
|-- fm-app ················································ 项目rest接口war包，提供对移动端（app，wx）的rest接口请求
|   |-- src
|   |   |-- main
|   |   |   |-- java
|   |   |   |   `-- 包路径            
|   |   |   |       |-- base ······························ 基本信息目录           
|   |   |   |       |   |-- config          
|   |   |   |       |   |   |-- RestConfig.java ··········· jersry框架里Servlet的配置类，一般不做修改          
|   |   |   |       |   |-- Config.java ··················· 利用spring-bean对配置信息的映射类           
|   |   |   |       |   `-- ReturnCode.java ··············· 异常信息的枚举           
|   |   |   |       |-- biz ······························· 逻辑层目录，主要封装service接口和第三方接口，以及对出入参数格式化            
|   |   |   |       |-- rest ······························ 控制层目录，主要接口前端传递的参数，校验参数的合法性            
|   |   |   |       `-- vo ································ 前后端交互的参数模型目录，模型一般以Vo结尾            
|   |   |   |           |-- 模块1             
|   |   |   |           `-- 模块2 
|   |   |   |-- resources ································· 项目资源目录
|   |   |   |   |-- config ································ 配置文件目录            
|   |   |   |   |   |-- local ····························· 本地调试配置信息目录           
|   |   |   |   |   |-- dev ······························· 开发服务器配置信息目录            
|   |   |   |   |   |-- test ······························ 测试环境配置信息目录            
|   |   |   |   |   `-- prod ······························ 生产环境配置信息目录            
|   |   |   |   |-- application-context.xml ··············· spring-bean的配置信息          
|   |   |   |   |-- dubbo-consumer.xml ···················· dubbo消费者的初始化配置信息            
|   |   |   |   `-- log4j.properties ······················ log4j日志的配置信息           
|   |   |   `-- webapp  ··································· war包的信息配置目录
|   |   |       |-- WEB-INF
|   |   |       |   `-- web.xml ··························· web项目入口，初始化配置信息
|   |   |       `-- index.jsp ····························· 项目初始化欢迎页
|   |   `-- test
|   |-- jetty.xml ········································· jetty描述文件，一般不做修改 
|   |-- pom.xml ··········································· 项目构建配置信息
|   `-- readMe.txt ········································ 部署说明，注意事项
|
|-- fm-backend ············································ 项目后台管理系统war包
|   |-- src
|   |   |-- main
|   |   |   |-- java
|   |   |   |   `-- 包路径             
|   |   |   |       |-- base ······························ 基本信息目录 
|   |   |   |       |   |-- Config.java ··················· 利用spring-bean对配置信息的映射类           
|   |   |   |       |   `-- ReturnCode.java ··············· 异常信息的枚举           
|   |   |   |       |-- biz ······························· 逻辑层目录，主要封装service接口和第三方接口，以及对出入参数格式化            
|   |   |   |       |-- controller ························ 控制层目录，主要接口前端传递的参数，校验参数的合法性            
|   |   |   |       |-- filter ···························· 过滤器目录            
|   |   |   |       |   `-- LoginFilter.java ·············· 登陆过滤器，管理登陆时的session信息         
|   |   |   |       `-- vo ································ 前后端交互的参数模型目录，模型一般以Vo结尾           
|   |   |   |           |-- 模块1              
|   |   |   |           `-- 模块2 
|   |   |   |-- resources ································· 资源目录，同上，不再详细说明
|   |   |   |   |-- config             
|   |   |   |   |   |-- local            
|   |   |   |   |   |-- dev            
|   |   |   |   |   |-- test             
|   |   |   |   |   `-- prod             
|   |   |   |   |-- application-context.xml            
|   |   |   |   |-- dubbo-consumer.xml             
|   |   |   |   `-- log4j.properties             
|   |   |   `-- webapp
|   |   |       |-- resources ····························· 前端静态资源目录
|   |   |       |-- views ································· jsp文件目录
|   |   |       |   |-- 模块1
|   |   |       |   |-- 模块2
|   |   |       |   `-- error ····························· 异常请求jsp文件目录
|   |   |       |-- WEB-INF  ······························ war包的信息配置目录
|   |   |       |   `-- web.xml ··························· web项目入口，初始化配置信息
|   |   |       `-- index.jsp ····························· 初始化欢迎页jsp
|   |   `-- test
|   |-- jetty.xml ········································· jetty描述文件，一般不做修改 
|   |-- jetty-env.xml ····································· jetty的配置文件，一般配置数据库连接信息
|   |-- pom.xml ··········································· 构建配置信息
|   `-- readMe.txt ········································ 部署说明，注意事项
|
|-- fm-web ················································ 项目web门户系统war包，同fm-backend项目，不再详细说明
|
`-- fm-service ············································ 项目dubbo-service包，对dubbo-api里的业务接口具体实现
    |-- src
    |   |-- assembly ······································ 打包配置目录
    |   |   |-- bin ······································· 启动脚本目录
    |   |   |   |-- run.bat ······························· windows环境启动脚本
    |   |   |   |-- run.sh ································ linux环境启动脚本 
    |   |   `-- assembly.xml ······························ service打包配置信息，一般不做修改
    |   |-- main
    |   |   |-- java
    |   |   |   `-- 包路径             
    |   |   |       |-- base ······························ 基本信息目录
    |   |   |       |   |-- Config.java ··················· 利用spring-bean对配置信息的映射类          
    |   |   |       |   |-- Constants.java ················ 常量类，提供本子项目所需使用的常量           
    |   |   |       |   `-- ReturnCode.java ··············· 异常信息的枚举          
    |   |   |       |-- dao ······························· Mybatis映射的接口目录     
    |   |   |       |-- entity ···························· 数据库表对应映射的实体类     
    |   |   |       |-- service ··························· 业务实现层，api接口的实现
    |   |   |       |-- InitApplication.java ·············· 应用初始化类，在容器初始化后调用            
    |   |   |       |-- Provider.java ····················· dubbo的启动类，运行main方法即可启动项目         
    |   |   `-- resources
    |   |       |-- config ································ 配置文件目录
    |   |       |   |-- local             
    |   |       |   |-- dev             
    |   |       |   |-- test             
    |   |       |   `-- prod 
    |   |       |-- mapper ································ Mybatis映射的xml文件目录  
    |   |       |-- META-INF ······························ jar包的信息配置目录
    |   |       |   `-- spring ···························· spring配置信息目录
    |   |       |       |-- dubbo-provider.xml ············ spring-bean的配置信息
    |   |       |       `-- spring-context.xml ············ duubo提供者的初始化配置信息
    |   |       |-- sql ··································· 初始化sql存放目录
    |   |       |   |-- initTabel.xml ····················· 初始化表结构sql
    |   |       |   `-- initDate.xml ······················ 初始化表数据sql
    |   |       |-- log4j.xml ····························· log4j日志的配置信息
    |   |       |-- generatorConfig.xml ··················· mybatis反向生成代码配置文件
    |   |       |-- mybatis-generator.properties ·········· mybatis反向生成代码配置信息
    |   |       `-- mybatis-config.xml ···················· mybatis配置信息
    |   `-- test
    |-- pom.xml ··········································· 构建配置信息
    `-- readMe.txt ········································ 部署说明，注意事项
```
### 设计思想
* 考虑到我们的系统往往是多端（移动端、web门户、后台管理）应用，但运行在不同的网络环境下（互联网，政务网），我们为每一端设计了一个web系统。
* 虽然我们是多端应用，但业务类似。避免重复业务带来重复代码，我们用一套业务处理系统来实现具体业务，以供各端应用调用，因此我们的业务接口必须要具有通用性，可供多端应用使用，这也是对各位设计能力的一个考验。
* 多端应用公用一套业务系统将会带来并发压力，考虑到性能、伸缩性、可用性和与spring框架结合的使用成本，我们选择了阿里的开源服务框架dubbo来解决这些问题，由api提供对外的业务接口，由service来实现具体业务。`ps：对于dubbo框架不了解的同学可以学习 http://dubbo.wangxingrong.com/User+Guide-zh.htm`
* 这个时候有小伙伴要问了，那我们每一端系统中的biz层是做什么的呢？<br>
我们有很多分布式应用，各个应用之间会有业务关联和调用，biz层的一个作用就是在这里把它们聚合起来，封装成一个可供前端小伙伴直接使用的业务接口。它还有一个重要作用就是对数据的格式化处理，以满足各端应用不同的显示效果。

### 使用规范
* 规范1111 
* 规范222

### 常见问题
* Q : service项目启动时，日志不停刷新如下内容：
    ``` java
    paginator.PageInterceptor - dialectClass: {***.paginator.dialect.OracleDialect} 
    paginator.PageInterceptor - asyncTotalCount: {false} 
    ```
  A : Mapper.xml中分页的sql有错误，检查近期提交的sql，特别是`parameterType`和`resultType`
  
* Q : 返回值code 400405
  A ：get/post请求使用错误


