## 开发指南

### 代码结构
当我们拿到一个使用了这套框架的初始化项目，亦或是一个成熟的项目，它的结构大概是这样的：
```
.fm-parent
|-- db-change ············································· 数据库表字段更改记录
|
|-- startup ··············································· 启动脚本，部分项目可能无
|
|-- fm-core ··············································· 项目公共jar包，一般存放功能变量及方法，小型项目可废弃。
|   |-- src 
|   |   |-- main
|   |   |   |-- java 
|   |   |   |   `-- 包路径             
|   |   |   |       |-- constants ························· 公共常量目录，各个子项目所需的内部常量，不包含api所需对外常量             
|   |   |   |       `-- utils ·····························         
|   |   |   `-- resources
|   |   `-- test
|   `-- pom.xml ···········································
|
|-- fm-api ················································ 服务层接口，dubbo-api包，提供服务层对外接口能力
|   |-- src 
|   |   |-- main
|   |   |   |-- java
|   |   |   |   `-- 包路径             
|   |   |   |       |-- constants ························· 常量目录，提供对外的常量；若无core子系统，则存放所有常量            
|   |   |   |       |-- api ······························· dubbo-api接口目录             
|   |   |   |       `-- model ····························· 接口出入参数模型目录，模型一般以Dto结尾            
|   |   |   |           |-- 模块1              
|   |   |   |           `-- 模块2              
|   |   |   `-- resources
|   |   |       `-- dubbo ································· duubo配置文件目录
|   |   |           `-- dubbo-consume-demo.xml ············ 提供给消费者的duubo接口，便于消费者集成
|   |   `-- test
|   `-- pom.xml ··········································· 构建配置信息
|
|-- fm-app ················································ 应用层，rest接口war包，提供移动端(app/wx等)的rest接口请求
|   |-- src
|   |   |-- main
|   |   |   |-- java
|   |   |   |   `-- 包路径            
|   |   |   |       |-- base ······························ 基本信息目录           
|   |   |   |       |   |-- config          
|   |   |   |       |   |   |-- RestConfig.java ··········· jersry框架里Servlet的配置类，一般不做修改          
|   |   |   |       |   |-- Config.java ··················· 利用spring-bean对配置信息的映射类           
|   |   |   |       |   `-- ReturnCode.java ··············· 异常信息的枚举           
|   |   |   |       |-- biz ······························· 应用逻辑层目录，主要聚合业务接口和第三方接口，对参数格式化            
|   |   |   |       |-- rest ······························ 应用控制层目录，主要接收前端传递的参数，校验参数的合法性            
|   |   |   |       `-- vo ································ 前后端交互的参数模型目录，模型一般以Vo结尾            
|   |   |   |           |-- 模块1             
|   |   |   |           `-- 模块2 
|   |   |   |-- resources ································· 项目资源目录
|   |   |   |   |-- config ································ 配置文件目录            
|   |   |   |   |   |-- local ····························· 本地调试配置信息目录           
|   |   |   |   |   |-- dev ······························· 开发服务器配置信息目录            
|   |   |   |   |   |-- test ······························ 测试环境配置信息目录            
|   |   |   |   |   `-- prod ······························ 生产环境配置信息目录            
|   |   |   |   |-- application-context.xml ··············· spring-bean的配置信息          
|   |   |   |   |-- dubbo-consumer.xml ···················· dubbo消费者的初始化配置信息            
|   |   |   |   `-- log4j.properties ······················ log4j日志的配置信息           
|   |   |   `-- webapp  ··································· war包的信息配置目录
|   |   |       |-- WEB-INF
|   |   |       |   `-- web.xml ··························· web项目入口，初始化配置信息
|   |   |       `-- index.jsp ····························· 项目初始化欢迎页
|   |   `-- test
|   |-- jetty.xml ········································· jetty描述文件，一般不做修改 
|   |-- pom.xml ··········································· 项目构建配置信息
|   `-- readMe.txt ········································ 部署说明，注意事项
|
|-- fm-backend ············································ 应用层，项目后台管理系统war包
|   |-- src
|   |   |-- main
|   |   |   |-- java
|   |   |   |   `-- 包路径             
|   |   |   |       |-- base ······························ 基本信息目录 
|   |   |   |       |   |-- Config.java ··················· 利用spring-bean对配置信息的映射类           
|   |   |   |       |   `-- ReturnCode.java ··············· 异常信息的枚举           
|   |   |   |       |-- biz ······························· 应用逻辑层目录，主要聚合业务接口和第三方接口，对参数格式化            
|   |   |   |       |-- controller ························ 应用控制层目录，主要接收前端传递的参数，校验参数的合法性           
|   |   |   |       |-- filter ···························· 过滤器目录            
|   |   |   |       |   `-- LoginFilter.java ·············· 登陆过滤器，管理登陆时的session信息         
|   |   |   |       `-- vo ································ 前后端交互的参数模型目录，模型一般以Vo结尾           
|   |   |   |           |-- 模块1              
|   |   |   |           `-- 模块2 
|   |   |   |-- resources ································· 资源目录，同上，不再详细说明
|   |   |   |   |-- config             
|   |   |   |   |   |-- local            
|   |   |   |   |   |-- dev            
|   |   |   |   |   |-- test             
|   |   |   |   |   `-- prod             
|   |   |   |   |-- application-context.xml            
|   |   |   |   |-- dubbo-consumer.xml             
|   |   |   |   `-- log4j.properties             
|   |   |   `-- webapp
|   |   |       |-- resources ····························· 前端静态资源目录
|   |   |       |-- views ································· jsp文件目录
|   |   |       |   |-- 模块1
|   |   |       |   |-- 模块2
|   |   |       |   `-- error ····························· 异常请求jsp文件目录
|   |   |       |-- WEB-INF  ······························ war包的信息配置目录
|   |   |       |   `-- web.xml ··························· web项目入口，初始化配置信息
|   |   |       `-- index.jsp ····························· 初始化欢迎页jsp
|   |   `-- test
|   |-- jetty.xml ········································· jetty描述文件，一般不做修改 
|   |-- jetty-env.xml ····································· jetty的配置文件，一般配置数据库连接信息
|   |-- pom.xml ··········································· 构建配置信息
|   `-- readMe.txt ········································ 部署说明，注意事项
|
|-- fm-web ················································ 应用层，项目web门户系统war包，类同backend项目，不详细说明
|
`-- fm-service ············································ 业务层，dubbo-service包，对dubbo-api里的业务接口具体实现
    |-- src
    |   |-- assembly ······································ 打包配置目录
    |   |   |-- bin ······································· 启动脚本目录
    |   |   |   |-- run.bat ······························· windows环境启动脚本
    |   |   |   |-- run.sh ································ linux环境启动脚本 
    |   |   `-- assembly.xml ······························ service打包配置信息，一般不做修改
    |   |-- main
    |   |   |-- java
    |   |   |   `-- 包路径             
    |   |   |       |-- base ······························ 基本信息目录
    |   |   |       |   |-- Config.java ··················· 利用spring-bean对配置信息的映射类          
    |   |   |       |   |-- Constants.java ················ 常量类，提供本子项目所需使用的常量           
    |   |   |       |   `-- ReturnCode.java ··············· 异常信息的枚举          
    |   |   |       |-- dao ······························· 业务持久化层，Mybatis映射的接口目录     
    |   |   |       |-- entity ···························· 数据库表对应映射的实体类     
    |   |   |       |-- service ··························· 业务实现层，api接口的实现
    |   |   |       |-- InitApplication.java ·············· 应用初始化类，在容器初始化后调用            
    |   |   |       |-- Provider.java ····················· dubbo的启动类，运行main方法即可启动项目         
    |   |   `-- resources
    |   |       |-- config ································ 配置文件目录
    |   |       |   |-- local             
    |   |       |   |-- dev             
    |   |       |   |-- test             
    |   |       |   `-- prod 
    |   |       |-- mapper ································ Mybatis映射的xml文件目录  
    |   |       |-- META-INF ······························ jar包的信息配置目录
    |   |       |   `-- spring ···························· spring配置信息目录
    |   |       |       |-- dubbo-provider.xml ············ spring-bean的配置信息
    |   |       |       `-- spring-context.xml ············ duubo提供者的初始化配置信息
    |   |       |-- sql ··································· 初始化sql存放目录
    |   |       |   |-- initTabel.xml ····················· 初始化表结构sql
    |   |       |   `-- initDate.xml ······················ 初始化表数据sql
    |   |       |-- log4j.xml ····························· log4j日志的配置信息
    |   |       |-- generatorConfig.xml ··················· mybatis反向生成代码配置文件
    |   |       |-- mybatis-generator.properties ·········· mybatis反向生成代码配置信息
    |   |       `-- mybatis-config.xml ···················· mybatis配置信息
    |   `-- test
    |-- pom.xml ··········································· 构建配置信息
    `-- readMe.txt ········································ 部署说明，注意事项
```
### 设计思想
* 考虑到现在的移动互联网时代系统往往是多端应用（移动端、wx端、web门户、后台管理），但是各应用运行的网络环境可能不同（互联网，内网、专线网络），每端应用单独成立一个web系统。
* 多端应用同属一个系统，业务可能类似比较高，避免重复业务带来重复代码加大维护成本，我们用一套业务处理系统来实现具体业务，以供各端应用在不同场景下使用，因此业务的接口需要具备通用性，可供多端应用使用，这对各位的设计能力来讲是一个考验（如何设计得通用且易于拓展）。
* 多端应用公用一套业务层系统会带来并发压力，考虑到性能、伸缩性、可用性和与spring框架结合的使用成本，我们选择阿里的开源服务框架dubbo来解决这些问题，由dubbo-api提供对外的业务接口，由dubbo-service来实现具体业务。`ps：对于dubbo框架不了解的同学可以学习 http://dubbo.wangxingrong.com/User+Guide-zh.htm`
* 这个时候有些同学不禁会疑惑，业务都有service处理了，应用中的biz层是做什么的呢？<br>
    > 我们有很多分布式应用，各个应用之间会有业务关联和调用，biz层的一个主要作用是把它们聚合起来，封装成适用于前端显示的业务接口；它还有一个重要作用就是对数据的格式化处理，以满足各端应用对数据不同的表现形式。

### 开发规范
* 安装`Alibaba Java Code Guidelines`插件，检查自身代码规范性。严格注意几点：
    +  不允许任何魔法值（即硬编码）直接出现在代码中
    + 类名、方法名、变量名尊从驼峰大小写格式，切勿出现单词拼写错误
    + 常量命名大写，单词间用下划线隔开
* `GET/POST`请求使用规范：
    + 搜索、查询、详情、显示等使用`get`
    + 提交、更新、删除等使用`post`
* 数据模型定义规范：
    + api接口层的数据模型，它是对外提供服务接口，为保护数据库数据结构，数据模型不可直接使用数据库映射的实体。<br>它的作用是展示层与服务层之间传递数据的对象，命名应以Dto（Data Transfer Object）结尾；
    + 应用层里的数据模型，它的作用是把某个指定页面的所有数据封装起来，因此把它定义为视图对象，命名应以Vo（View Object）结尾。
    + 有些同学不禁会疑惑，在实际业务中我们只是简单的查询，为什么要定义这么多模型对象？用一个例子来说明可能会比较容易理解：
        > 例如：服务层有一个getUser的方法返回一个系统用户，其中有一个属性是gender（性别），对于服务层来说，它只从语义上定义：1-男性，2-女性，0-未指定。<br>而我们的服务同时供多个客户端使用，不同的客户端对于表现层的要求有所不同（app端显示 1-帅哥，2-美女，0-未知；web门户显示1-男性，2-女性，0-未指定），就会出现问题了。<br>再者，回到设计层面上分析，从职责单一原则来看，服务层只负责业务（返回 1，2，0）与具体的表现形式无关，因此它返回的数据不应该出现与表现形式的耦合。
* dubbo-api内的Dto数据模型为远程调用模型，**必须序列化**（即实现Serializable接口，可安装GenerateSerialVersionUID插件自动生成serialVersionUID），否则dubbo服务调用会出错。
* 



